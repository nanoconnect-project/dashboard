<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜ë…¸ì»¤ë„¥íŠ¸ ìƒ˜í”Œ í˜„í™© ëŒ€ì‹œë³´ë“œ</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap');

  :root {
    --bg:       #F4F6FA;
    --surface:  #FFFFFF;
    --surface2: #F0F3F9;
    --border:   #DDE3EF;
    --border2:  #C8D0E0;

    --kimm:    #0057FF;   /* ì§„ì²­ */
    --skku:    #00A878;   /* ì—ë©”ë„ë“œ */
    --nnfc:    #7C3AED;   /* ë°”ì´ì˜¬ë › */
    --kit:     #EA4C2B;   /* ë²„ë°€ë¦¬ì˜¨ */
    --finelab: #D97706;   /* ì•°ë²„ */

    --accent:  #0057FF;
    --accent2: #00A878;
    --accent3: #EA4C2B;
    --accent4: #7C3AED;
    --warn:    #D97706;
    --danger:  #DC2626;
    --success: #059669;

    --text:    #0F172A;
    --text2:   #334155;
    --muted:   #64748B;

    --shadow-sm: 0 1px 3px rgba(0,0,0,0.07), 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.05);
    --shadow-lg: 0 10px 30px rgba(0,0,0,0.10), 0 4px 8px rgba(0,0,0,0.06);

    --mono: 'IBM Plex Mono', monospace;
    --sans: 'Pretendard', 'Noto Sans KR', sans-serif;
    --radius: 10px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--sans);
    font-size: 18px;
    font-weight: 400;
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ë°°ê²½ ë¯¸ì„¸ íŒ¨í„´ */
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image: radial-gradient(circle, rgba(0,87,255,0.04) 1px, transparent 1px);
    background-size: 28px 28px;
    pointer-events: none; z-index: 0;
  }

  .wrapper { position: relative; z-index: 1; max-width: 1440px; margin: 0 auto; padding: 0 32px 80px; }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    background: var(--surface);
    border-bottom: 2px solid var(--kimm);
    padding: 24px 32px;
    margin: 0 -32px 28px;
    display: flex; align-items: center; justify-content: space-between;
    gap: 20px; flex-wrap: wrap;
    box-shadow: var(--shadow-sm);
    position: sticky; top: 0; z-index: 50;
  }
  .logo-block { display: flex; align-items: center; gap: 16px; }
  .logo-icon {
    width: 52px; height: 52px; border-radius: 10px;
    background: linear-gradient(135deg, var(--kimm), #4B8BFF);
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0,87,255,0.3);
  }
  .logo-label { font-family: var(--mono); font-size: 13px; letter-spacing: 0.15em; color: var(--kimm); text-transform: uppercase; font-weight: 500; margin-bottom: 3px; }
  .logo-title { font-size: 24px; font-weight: 700; color: var(--text); letter-spacing: -0.02em; }
  .logo-title span { color: var(--kimm); }
  .header-meta { font-family: var(--mono); font-size: 14px; color: var(--muted); text-align: right; line-height: 2; }
  .header-meta strong { color: var(--text2); font-weight: 600; }

  /* â”€â”€ LOADING OVERLAY â”€â”€ */
  #loading-overlay {
    position: fixed; inset: 0; background: rgba(255,255,255,0.97);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 200; gap: 24px; transition: opacity 0.4s;
  }
  #loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .spinner {
    width: 48px; height: 48px;
    border: 3px solid var(--border);
    border-top-color: var(--kimm);
    border-radius: 50%;
    animation: spin 0.75s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 18px; font-weight: 600; color: var(--text2); letter-spacing: 0.02em; }
  .loading-items { font-family: var(--mono); font-size: 14px; color: var(--muted); text-align: center; line-height: 2.2; }
  .loading-item-done { color: var(--success); font-weight: 600; }
  .loading-item-fail { color: var(--danger); }

  /* â”€â”€ ERROR BANNER â”€â”€ */
  .error-banner {
    background: #FEF2F2; border: 1px solid #FECACA;
    border-radius: var(--radius); padding: 14px 18px; margin-bottom: 20px;
    font-size: 16px; color: var(--danger); display: none; font-weight: 500;
  }
  .error-banner.show { display: block; }

  /* â”€â”€ TABS â”€â”€ */
  .tab-bar {
    display: flex; gap: 2px; margin: 0 0 28px;
    background: var(--surface); border-radius: 12px; padding: 5px;
    box-shadow: var(--shadow-sm); width: fit-content;
  }
  .tab {
    font-family: var(--sans); font-size: 17px; font-weight: 500;
    padding: 10px 24px; border: none; cursor: pointer;
    color: var(--muted); background: transparent;
    border-radius: 9px; transition: all 0.2s;
  }
  .tab:hover { color: var(--text2); background: var(--surface2); }
  .tab.active {
    color: var(--kimm); background: rgba(0,87,255,0.08);
    font-weight: 600; box-shadow: 0 1px 4px rgba(0,87,255,0.15);
  }

  .tab-content { }
  .section { display: none; }
  .section.active { display: block; }

  /* â”€â”€ REFRESH ROW â”€â”€ */
  .refresh-row {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 20px; flex-wrap: wrap; gap: 12px;
  }
  .last-updated { font-family: var(--mono); font-size: 14px; color: var(--muted); }
  .last-updated span { color: var(--success); font-weight: 600; }
  .refresh-btn {
    font-family: var(--sans); font-size: 16px; font-weight: 600;
    padding: 10px 22px; background: var(--kimm);
    border: none; border-radius: 8px;
    color: #fff; cursor: pointer; transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0,87,255,0.25);
  }
  .refresh-btn:hover { background: #0044CC; box-shadow: 0 4px 12px rgba(0,87,255,0.35); transform: translateY(-1px); }
  .refresh-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  /* â”€â”€ SUMMARY BAR â”€â”€ */
  .summary-bar { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 14px; margin-bottom: 22px; }
  .summary-item {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 18px 20px;
    display: flex; align-items: center; gap: 14px;
    box-shadow: var(--shadow-sm); transition: box-shadow 0.2s;
  }
  .summary-item:hover { box-shadow: var(--shadow-md); }
  .summary-icon { font-size: 32px; flex-shrink: 0; }
  .summary-num { font-family: var(--mono); font-size: 32px; font-weight: 700; line-height: 1; }
  .summary-lbl { font-size: 14px; color: var(--muted); margin-top: 3px; font-weight: 500; }

  /* â”€â”€ ALERT â”€â”€ */
  .alert-box {
    background: #FFFBEB; border: 1px solid #FDE68A;
    border-left: 4px solid var(--warn);
    border-radius: var(--radius); padding: 16px 20px; margin-bottom: 22px;
    font-size: 17px; line-height: 1.9; color: var(--text2);
    box-shadow: var(--shadow-sm);
  }
  .alert-box strong { color: #92400E; font-weight: 700; }

  /* â”€â”€ CARDS â”€â”€ */
  .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 18px; }
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 24px;
    position: relative; overflow: hidden;
    transition: box-shadow 0.25s, transform 0.25s;
    box-shadow: var(--shadow-sm);
  }
  .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; border-radius: 14px 14px 0 0; }
  .card.kimm::before   { background: linear-gradient(90deg, #0057FF, #4B8BFF); }
  .card.skku::before   { background: linear-gradient(90deg, #00A878, #34D399); }
  .card.nnfc::before   { background: linear-gradient(90deg, #7C3AED, #A78BFA); }
  .card.kit::before    { background: linear-gradient(90deg, #EA4C2B, #FB923C); }
  .card.finelab::before{ background: linear-gradient(90deg, #D97706, #FCD34D); }
  .card:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); }

  .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 18px; }
  .card-title { font-size: 13px; font-weight: 600; letter-spacing: 0.12em; color: var(--muted); text-transform: uppercase; margin-bottom: 5px; }
  .card-org { font-size: 22px; font-weight: 700; }
  .card-org.kimm   { color: var(--kimm); }
  .card-org.skku   { color: var(--skku); }
  .card-org.nnfc   { color: var(--nnfc); }
  .card-org.kit    { color: var(--kit); }
  .card-org.finelab{ color: var(--finelab); }

  .badge { font-size: 13px; font-weight: 600; padding: 5px 12px; border-radius: 100px; }
  .badge-ok   { background: #D1FAE5; color: #065F46; }
  .badge-warn { background: #FEF3C7; color: #92400E; }
  .badge-info { background: #DBEAFE; color: #1E40AF; }
  .badge-none { background: var(--surface2); color: var(--muted); }

  .progress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
  .progress-label { font-size: 16px; color: var(--text2); font-weight: 500; }
  .progress-count { font-family: var(--mono); font-size: 16px; font-weight: 600; color: var(--text); }
  .progress-bar-bg { height: 10px; background: var(--surface2); border-radius: 5px; overflow: hidden; margin-bottom: 18px; }
  .progress-bar-fill { height: 100%; border-radius: 4px; transition: width 0.9s cubic-bezier(0.16,1,0.3,1); }
  .fill-kimm   { background: linear-gradient(90deg, #0057FF, #4B8BFF); }
  .fill-skku   { background: linear-gradient(90deg, #00A878, #34D399); }
  .fill-nnfc   { background: linear-gradient(90deg, #7C3AED, #A78BFA); }
  .fill-kit    { background: linear-gradient(90deg, #EA4C2B, #FB923C); }
  .fill-finelab{ background: linear-gradient(90deg, #D97706, #FCD34D); }

  .stat-row { display: flex; gap: 0; border-top: 1px solid var(--border); padding-top: 16px; }
  .stat-item { flex: 1; text-align: center; }
  .stat-item + .stat-item { border-left: 1px solid var(--border); }
  .stat-value { font-family: var(--mono); font-size: 32px; font-weight: 700; line-height: 1; margin-bottom: 4px; }
  .stat-label { font-size: 14px; color: var(--muted); font-weight: 500; }

  /* â”€â”€ FLOW â”€â”€ */
  .flow-section {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; padding: 28px; margin-bottom: 20px;
    box-shadow: var(--shadow-sm);
  }
  .flow-title {
    font-size: 14px; font-weight: 700; letter-spacing: 0.12em;
    color: var(--muted); text-transform: uppercase; margin-bottom: 22px;
    display: flex; align-items: center; gap: 8px;
  }
  .flow-title::before { content: ''; display: inline-block; width: 14px; height: 3px; background: var(--kimm); border-radius: 2px; }
  .flow-diagram { display: flex; align-items: center; overflow-x: auto; padding-bottom: 8px; gap: 0; }
  .flow-node {
    flex-shrink: 0; text-align: center; padding: 18px 20px;
    border: 1.5px solid var(--border); border-radius: 10px;
    min-width: 120px; background: var(--surface);
    box-shadow: var(--shadow-sm); transition: box-shadow 0.2s;
  }
  .flow-node:hover { box-shadow: var(--shadow-md); }
  .flow-node-org { font-family: var(--sans); font-size: 17px; font-weight: 700; margin-bottom: 5px; }
  .flow-node-desc { font-size: 14px; color: var(--muted); line-height: 1.5; }
  .flow-arrow { flex-shrink: 0; display: flex; flex-direction: column; align-items: center; padding: 0 6px; gap: 4px; }
  .flow-arrow-line { width: 48px; height: 2px; background: var(--border2); position: relative; }
  .flow-arrow-line::after { content: 'â–¶'; position: absolute; right: -10px; top: -8px; font-size: 13px; color: var(--border2); }
  .flow-arrow-label { font-family: var(--mono); font-size: 12px; color: var(--kimm); white-space: nowrap; font-weight: 600; }
  .flow-two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  @media(max-width:700px){ .flow-two-col { grid-template-columns: 1fr; } }

  /* â”€â”€ TABLE â”€â”€ */
  .table-wrapper {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; overflow: hidden; margin-bottom: 20px;
    box-shadow: var(--shadow-sm);
  }
  .table-header-row {
    padding: 16px 22px 14px; border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;
    background: var(--surface2);
  }
  .table-title { font-size: 16px; font-weight: 700; letter-spacing: 0.08em; color: var(--text2); text-transform: uppercase; }
  .month-select {
    font-family: var(--mono); font-size: 16px; background: var(--surface);
    border: 1.5px solid var(--border); color: var(--text);
    padding: 8px 16px; border-radius: 8px; cursor: pointer; outline: none;
    font-weight: 500;
  }
  .month-select:focus { border-color: var(--kimm); }
  table { width: 100%; border-collapse: collapse; font-size: 17px; }
  thead th {
    font-size: 13px; font-weight: 700; letter-spacing: 0.08em;
    color: var(--muted); text-transform: uppercase;
    padding: 14px 18px; text-align: left;
    border-bottom: 1px solid var(--border); white-space: nowrap;
    background: var(--surface2);
  }
  tbody tr { border-bottom: 1px solid var(--border); transition: background 0.15s; }
  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: #F0F5FF; }
  tbody td { padding: 15px 18px; vertical-align: middle; }
  .td-mono { font-family: var(--mono); font-size: 16px; }
  .qty-display { font-family: var(--mono); display: flex; align-items: center; gap: 5px; font-size: 16px; }
  .qty-done { color: var(--success); font-weight: 700; }
  .qty-slash { color: var(--muted); }
  .qty-total { color: var(--muted); }
  .no-data { text-align: center; padding: 40px; color: var(--muted); font-size: 17px; }

  /* â”€â”€ SCHEDULE â”€â”€ */
  .schedule-header { display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
  .schedule-meta { font-size: 16px; color: var(--muted); margin-bottom: 6px; line-height: 1.6; font-weight: 500; }
  .sch-global-bar-bg { height: 6px; background: var(--border); border-radius: 3px; margin-bottom: 28px; overflow: hidden; }
  .sch-global-bar-fill { height: 100%; background: linear-gradient(90deg, var(--kimm), var(--skku)); border-radius: 3px; transition: width 1s cubic-bezier(0.16,1,0.3,1); }
  .schedule-pct-label { font-family: var(--mono); font-size: 17px; font-weight: 600; color: var(--text2); }
  .schedule-pct-label span { color: var(--skku); font-weight: 700; font-size: 26px; }
  .schedule-legend { display: flex; gap: 16px; flex-wrap: wrap; }
  .leg-item { display: flex; align-items: center; gap: 7px; font-size: 16px; color: var(--muted); font-weight: 500; }
  .leg-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }

  .quarters-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 20px; }
  @media(max-width:900px){ .quarters-grid { grid-template-columns: 1fr; } }
  .quarter-block {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 14px; overflow: hidden; box-shadow: var(--shadow-sm);
  }
  .quarter-header {
    padding: 18px 22px 16px; border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
    background: var(--surface2);
  }
  .quarter-label { font-size: 13px; font-weight: 700; letter-spacing: 0.15em; color: var(--muted); text-transform: uppercase; margin-bottom: 5px; }
  .quarter-title { font-size: 17px; font-weight: 700; line-height: 1.4; color: var(--text); }
  .qpct { font-family: var(--mono); font-size: 32px; font-weight: 700; line-height: 1; }
  .qpct-label { font-size: 13px; color: var(--muted); font-weight: 600; text-align: right; }
  .quarter-bar-bg { height: 4px; background: var(--border); }
  .quarter-bar-fill { height: 100%; transition: width 0.8s cubic-bezier(0.16,1,0.3,1); }
  .months-list { padding: 10px 0 14px; }
  .month-group { padding-bottom: 4px; }
  .month-label-row { padding: 12px 22px 7px; display: flex; align-items: center; gap: 10px; }
  .month-badge {
    font-size: 13px; font-weight: 700; padding: 4px 14px;
    border-radius: 100px; border: 1.5px solid var(--border2);
    color: var(--text2); letter-spacing: 0.06em; white-space: nowrap;
    background: var(--surface2);
  }
  .month-rule { flex: 1; height: 1px; background: var(--border); }
  .task-item {
    display: flex; align-items: flex-start; gap: 14px;
    padding: 10px 24px; cursor: pointer;
    transition: background 0.15s; border-radius: 6px; margin: 0 10px;
  }
  .task-item:hover { background: #F0F5FF; }
  .task-item.milestone { background: #FFFBEB; }
  .task-item.milestone:hover { background: #FEF3C7; }
  .task-checkbox {
    flex-shrink: 0; width: 22px; height: 22px; border-radius: 5px;
    border: 2px solid var(--border2); display: flex; align-items: center;
    justify-content: center; margin-top: 2px; transition: all 0.2s;
    background: var(--surface);
  }
  .task-item.done .task-checkbox { background: var(--success); border-color: var(--success); }
  .task-item.done .task-checkbox::after { content: 'âœ“'; font-size: 13px; color: #fff; font-weight: 700; }
  .task-right { flex: 1; min-width: 0; }
  .task-text { font-size: 17px; line-height: 1.55; color: var(--text); transition: color 0.2s; }
  .task-item.done .task-text { color: var(--muted); text-decoration: line-through; text-decoration-color: var(--muted); }
  .task-item.milestone .task-text { font-weight: 700; }
  .task-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }
  .task-tag { font-size: 13px; font-weight: 600; padding: 3px 10px; border-radius: 4px; border: 1.5px solid; white-space: nowrap; }
  .tag-kimm { color: var(--kimm);    border-color: #BFDBFE; background: #EFF6FF; }
  .tag-skku { color: var(--skku);    border-color: #A7F3D0; background: #ECFDF5; }
  .tag-nnfc { color: var(--nnfc);    border-color: #DDD6FE; background: #F5F3FF; }
  .tag-kit  { color: var(--kit);     border-color: #FDBA74; background: #FFF7ED; }
  .tag-fl   { color: var(--finelab); border-color: #FDE68A; background: #FFFBEB; }
  .milestone-star { font-size: 18px; color: var(--finelab); flex-shrink: 0; margin-top: 1px; }

  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--surface2); }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--muted); }
</style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loading-overlay">
  <div class="spinner"></div>
  <div class="loading-text">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div class="loading-items" id="loading-items"></div>
</div>

<div class="wrapper">
  <header>
    <div>
      <div class="logo-label">NRF NanoConnect Â· ê³¼ì œê´€ë¦¬ì‹œìŠ¤í…œ</div>
      <div class="logo-title">ë‚˜ë…¸ì»¤ë„¥íŠ¸ <span>ìƒ˜í”Œ í˜„í™©</span> ëŒ€ì‹œë³´ë“œ</div>
    </div>
    <div class="header-meta">
      <div>í˜„ì¬ ì›”: <strong id="hdr-month">â€”</strong></div>
      <div>ë°ì´í„° ê¸°ì¤€: <strong id="hdr-updated">â€”</strong></div>
      <div>ì°¸ì—¬ê¸°ê´€: <strong>5ê°œ ê¸°ê´€</strong></div>
    </div>
  </header>

  <div class="tab-bar">
    <button class="tab active" data-tab="overview">ğŸ“Š ì›”ê°„ í˜„í™©</button>
    <button class="tab" data-tab="flow">ğŸ”€ ìƒ˜í”Œ íë¦„</button>
    <button class="tab" data-tab="tracker">ğŸ“‹ ìƒì„¸ ì¶”ì </button>
    <button class="tab" data-tab="schedule">ğŸ“… 2026 ì¶”ì§„ ì¼ì •</button>
  </div>

  <div class="tab-content">
    <div id="error-banner" class="error-banner"></div>

    <!-- â”€â”€ OVERVIEW â”€â”€ -->
    <div id="tab-overview" class="section active">
      <div class="refresh-row">
        <div class="last-updated">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="last-updated-time">â€”</span></div>
        <button class="refresh-btn" id="refresh-btn" onclick="loadData()">â†» ìƒˆë¡œê³ ì¹¨</button>
      </div>
      <div class="summary-bar" id="summary-bar">
        <div class="summary-item"><div class="summary-icon">ğŸ“¦</div><div><div class="summary-num" id="sum-done" style="color:var(--accent2)">â€”</div><div class="summary-lbl">ì´ë²ˆ ë‹¬ ì™„ë£Œ</div></div></div>
        <div class="summary-item"><div class="summary-icon">ğŸ¯</div><div><div class="summary-num" id="sum-plan" style="color:var(--text)">â€”</div><div class="summary-lbl">ì´ë²ˆ ë‹¬ ëª©í‘œ</div></div></div>
        <div class="summary-item"><div class="summary-icon">âœ…</div><div><div class="summary-num" id="sum-pct" style="color:var(--success)">â€”</div><div class="summary-lbl">ì „ì²´ ë‹¬ì„±ë¥ </div></div></div>
        <div class="summary-item"><div class="summary-icon">âš ï¸</div><div><div class="summary-num" id="sum-warn" style="color:var(--warn)">â€”</div><div class="summary-lbl">ë³‘ëª© í•­ëª©</div></div></div>
        <div class="summary-item"><div class="summary-icon">ğŸšš</div><div><div class="summary-num" id="sum-pending" style="color:var(--accent)">â€”</div><div class="summary-lbl">ì „ë‹¬ ëŒ€ê¸°</div></div></div>
      </div>
      <div class="alert-box" id="alert-box">ë°ì´í„° ë¡œë“œ ì¤‘...</div>
      <div class="cards-grid" id="cards-grid"></div>
    </div>

    <!-- â”€â”€ FLOW â”€â”€ -->
    <div id="tab-flow" class="section">
      <div class="flow-section">
        <div class="flow-title">â–¸ ê³µì • 1 â€” SKKU ê¸°ë°˜ (ìˆœì„œ ì¤‘ìš”)</div>
        <div class="flow-diagram">
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">í¬ìƒì¸µ<br>ê¸°íŒ ì œì‘</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ê¸°íŒ ì „ë‹¬</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent2)">SKKU</div><div class="flow-node-desc">QD-EL<br>ë°•ë§‰ ì œì‘</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ë°•ë§‰ ì „ë‹¬</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">ë¡¤ ìŠ¤íƒ¬í”„<br>ì „ì‚¬</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ì „ì‚¬ ê¸°íŒ</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent4)">NNFC</div><div class="flow-node-desc">ë§ˆìŠ¤í¬<br>íŒ¨í„´ í˜•ì„±</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ë°˜í™˜</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">RIE í™”ì†Œ<br>íŒ¨í„°ë‹Â·ì ë“±</div></div>
        </div>
      </div>
      <div class="flow-section">
        <div class="flow-title">â–¸ ê³µì • 2 â€” íŒŒì¸ë© ê¸°ë°˜ (ìˆœì„œ ì¤‘ìš”)</div>
        <div class="flow-diagram">
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">í¬ìƒì¸µ<br>ê¸°íŒ ì œì‘</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ê¸°íŒ ì „ë‹¬</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--warn)">íŒŒì¸ë©</div><div class="flow-node-desc">QD ë°•ë§‰<br>ìƒ˜í”Œ ì œì‘</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ë°•ë§‰ ì „ë‹¬</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">ë¡¤ ìŠ¤íƒ¬í”„<br>ì „ì‚¬</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ì „ì‚¬ ê¸°íŒ</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent4)">NNFC</div><div class="flow-node-desc">ë§ˆìŠ¤í¬<br>íŒ¨í„´ í˜•ì„±</div></div>
          <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ë°˜í™˜</div></div>
          <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">RIE í™”ì†Œ<br>íŒ¨í„°ë‹Â·ì ë“±</div></div>
        </div>
      </div>
      <div class="flow-section" style="margin-bottom:0">
        <div class="flow-title">â–¸ ë…ë¦½ ê³µì • â€” ìˆœì„œ ë¬´ê´€</div>
        <div class="flow-two-col">
          <div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:10px">NNFC â†’ KIMM</div>
            <div class="flow-diagram">
              <div class="flow-node"><div class="flow-node-org" style="color:var(--accent4)">NNFC</div><div class="flow-node-desc">8ì¸ì¹˜<br>ë°±í”Œë ˆì¸</div></div>
              <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">2ë‹¬ / 5ë§¤</div></div>
              <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">ì „ì‚¬ ê¸°íŒ<br>í™œìš©</div></div>
            </div>
          </div>
          <div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:10px">ê¸ˆì˜¤ê³µëŒ€ â†’ KIMM</div>
            <div class="flow-diagram">
              <div class="flow-node"><div class="flow-node-org" style="color:var(--accent3)">ê¸ˆì˜¤ê³µëŒ€</div><div class="flow-node-desc">SMP ì½”íŒ…<br>PET í•„ë¦„</div></div>
              <div class="flow-arrow"><div class="flow-arrow-line"></div><div class="flow-arrow-label">ì›” 10ë§¤</div></div>
              <div class="flow-node"><div class="flow-node-org" style="color:var(--accent)">KIMM</div><div class="flow-node-desc">ë¡¤ ìŠ¤íƒ¬í”„<br>ì†Œì¬ í™œìš©</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ TRACKER â”€â”€ -->
    <div id="tab-tracker" class="section">
      <div class="table-wrapper">
        <div class="table-header-row">
          <div class="table-title">â–¸ ê¸°ê´€ë³„ ìƒ˜í”Œ ì „ë‹¬ ì¶”ì </div>
          <select class="month-select" id="month-select" onchange="renderTracker()"></select>
        </div>
        <div style="overflow-x:auto">
          <table>
            <thead>
              <tr>
                <th>ë°°ì¹˜ ID</th><th>ë°œì‹ </th><th>ìˆ˜ì‹ </th><th>ìƒ˜í”Œ ì¢…ë¥˜</th>
                <th>ê³„íš</th><th>ì™„ë£Œ / ê³„íš</th><th>ì™„ë£ŒÂ·ë°œì†¡ì¼</th><th>ìƒíƒœ</th><th>ë¹„ê³ </th>
              </tr>
            </thead>
            <tbody id="tracker-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ SCHEDULE â”€â”€ -->
    <div id="tab-schedule" class="section">
      <div class="schedule-header">
        <div>
          <div class="schedule-meta">2026ë…„ 3ì°¨ë…„ë„ Â· 8ì¸ì¹˜ ì›¨ì´í¼ 5000 PPIê¸‰ ì»¬ëŸ¬ QD-EL ì‹œì‘í’ˆ êµ¬í˜„ ë° ê³µì¸ì¸ì¦</div>
          <div class="schedule-pct-label">ì „ì²´ ë‹¬ì„±ë¥  <span id="sch-total-pct">0%</span></div>
        </div>
        <div class="schedule-legend">
          <span class="leg-item"><span class="leg-dot" style="background:var(--success)"></span>ì™„ë£Œ</span>
          <span class="leg-item"><span class="leg-dot" style="background:var(--border)"></span>ì˜ˆì •</span>
          <span class="leg-item"><span style="color:var(--warn);font-size:11px">â˜…</span> ë§ˆì¼ìŠ¤í†¤</span>
        </div>
      </div>
      <div class="sch-global-bar-bg"><div class="sch-global-bar-fill" id="sch-global-bar" style="width:0%"></div></div>
      <div class="quarters-grid" id="schedule-root"></div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG â€” GitHub Raw URL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BASE = 'https://raw.githubusercontent.com/nanoconnect-project';

const SOURCES = {
  skku:           `${BASE}/SKKU-QD-synthesis/main/samples/skku_samples.csv`,
  finelab:        `${BASE}/FineLab-frontplane/main/samples/finelab_samples.csv`,
  nnfc_backplane: `${BASE}/NNFC-backplane/main/samples/nnfc_backplane.csv`,
  nnfc_masking:   `${BASE}/NNFC-backplane/main/samples/nnfc_masking.csv`,
  kit:            `${BASE}/KIT-SMP-film/main/samples/kit_samples.csv`,
  kimm_sub:       `${BASE}/KIMM-roll-transfer/main/samples/kimm_substrate.csv`,
  kimm_tr:        `${BASE}/KIMM-roll-transfer/main/samples/kimm_transfer.csv`,
};

const SOURCE_LABELS = {
  skku: 'SKKU', finelab: 'íŒŒì¸ë©',
  nnfc_backplane: 'NNFC ë°±í”Œë ˆì¸', nnfc_masking: 'NNFC ë§ˆìŠ¤í¬',
  kit: 'ê¸ˆì˜¤ê³µëŒ€', kimm_sub: 'KIMM ê¸°íŒ', kimm_tr: 'KIMM ì „ì‚¬',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let DB = {};          // íŒŒì‹±ëœ ì „ì²´ ë°ì´í„°
let CURRENT_MONTH = '';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CSV PARSER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseCSV(text) {
  const lines = text.trim().split('\n').map(l => l.trim()).filter(Boolean);
  if (lines.length < 2) return [];
  const headers = lines[0].split(',').map(h => h.trim());
  return lines.slice(1).map(line => {
    // ì‰¼í‘œ í¬í•¨ ì…€(ë”°ì˜´í‘œ) ì²˜ë¦¬
    const values = [];
    let cur = '', inQ = false;
    for (const ch of line) {
      if (ch === '"') { inQ = !inQ; }
      else if (ch === ',' && !inQ) { values.push(cur.trim()); cur = ''; }
      else cur += ch;
    }
    values.push(cur.trim());
    return Object.fromEntries(headers.map((h, i) => [h, (values[i] ?? '').trim()]));
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FETCH ALL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadData() {
  const btn = document.getElementById('refresh-btn');
  btn.disabled = true;
  btn.textContent = 'âŸ³ ë¡œë”© ì¤‘...';

  const overlay = document.getElementById('loading-overlay');
  const itemsEl = document.getElementById('loading-items');
  overlay.classList.remove('hidden');
  itemsEl.innerHTML = Object.values(SOURCE_LABELS).map(l => `<div id="li-${l}">${l} ...</div>`).join('');

  const errors = [];

  await Promise.all(Object.entries(SOURCES).map(async ([key, url]) => {
    const label = SOURCE_LABELS[key];
    const el = document.getElementById(`li-${label}`);
    try {
      const res = await fetch(url + '?nocache=' + Date.now());
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const text = await res.text();
      DB[key] = parseCSV(text);
      if (el) { el.textContent = `âœ“ ${label}`; el.className = 'loading-item-done'; }
    } catch (e) {
      DB[key] = [];
      errors.push(`${label}: ${e.message}`);
      if (el) { el.textContent = `âœ— ${label} (ì‹¤íŒ¨)`; el.className = 'loading-item-fail'; }
    }
  }));

  await new Promise(r => setTimeout(r, 600)); // ê²°ê³¼ ì ê¹ í‘œì‹œ
  overlay.classList.add('hidden');

  const now = new Date();
  CURRENT_MONTH = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  document.getElementById('hdr-month').textContent = CURRENT_MONTH;
  document.getElementById('last-updated-time').textContent =
    now.toLocaleString('ko-KR', {year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
  document.getElementById('hdr-updated').textContent =
    now.toLocaleString('ko-KR', {month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});

  // Error banner
  const errEl = document.getElementById('error-banner');
  if (errors.length) {
    errEl.textContent = `âš  ì¼ë¶€ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${errors.join(' | ')} â€” í•´ë‹¹ ê¸°ê´€ ë ˆí¬ì§€í† ë¦¬ê°€ publicì¸ì§€ í™•ì¸í•˜ì„¸ìš”.`;
    errEl.classList.add('show');
  } else {
    errEl.classList.remove('show');
  }

  buildMonthSelect();
  renderOverview();
  renderTracker();

  btn.disabled = false;
  btn.textContent = 'â†» ìƒˆë¡œê³ ì¹¨';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getMonthRows(key) {
  return (DB[key] || []).filter(r => {
    const ym = r.year_month || r.period || '';
    return ym.startsWith(CURRENT_MONTH) || ym.includes(CURRENT_MONTH.slice(5,7));
  });
}

function pct(done, plan) {
  if (!plan || plan === 0) return 0;
  return Math.min(100, Math.round(done / plan * 100));
}

function statusBadge(s) {
  if (!s) return `<span class="badge badge-none">â€”</span>`;
  if (['ë°œì†¡ì™„ë£Œ','NNFCë°œì†¡ì™„ë£Œ','ì™„ë£Œ','ë°˜í™˜ì™„ë£Œ'].includes(s)) return `<span class="badge badge-ok">${s}</span>`;
  if (['ì œì‘ì¤‘','ì „ì‚¬ì¤‘','ì‘ì—…ì¤‘','ì§„í–‰ì¤‘'].includes(s)) return `<span class="badge badge-warn">${s}</span>`;
  return `<span class="badge badge-info">${s}</span>`;
}

const ORG_COLOR = { KIMM:'var(--accent)', SKKU:'var(--accent2)', NNFC:'var(--accent4)', ê¸ˆì˜¤ê³µëŒ€:'var(--accent3)', íŒŒì¸ë©:'var(--warn)' };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MONTH SELECT (TRACKER)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildMonthSelect() {
  const allMonths = new Set();
  Object.values(DB).forEach(rows => rows.forEach(r => {
    const ym = r.year_month || '';
    if (/^\d{4}-\d{2}$/.test(ym)) allMonths.add(ym);
  }));
  const sorted = [...allMonths].sort().reverse();
  if (!sorted.includes(CURRENT_MONTH)) sorted.unshift(CURRENT_MONTH);
  const sel = document.getElementById('month-select');
  sel.innerHTML = sorted.map(m => `<option value="${m}"${m===CURRENT_MONTH?' selected':''}>${m.replace('-','ë…„ ')}ì›”</option>`).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OVERVIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderOverview() {
  // â”€â”€ ê¸°ê´€ë³„ ì§‘ê³„ â”€â”€
  const orgs = buildOrgStats();

  // â”€â”€ Summary â”€â”€
  let totalDone = 0, totalPlan = 0, warnCount = 0, pendingCount = 0;
  orgs.forEach(o => {
    totalDone += o.done; totalPlan += o.plan;
    if (o.status === 'warn') warnCount++;
    pendingCount += o.pending;
  });
  document.getElementById('sum-done').textContent = totalDone;
  document.getElementById('sum-plan').textContent = totalPlan;
  const p = pct(totalDone, totalPlan);
  document.getElementById('sum-pct').textContent = p + '%';
  document.getElementById('sum-pct').style.color = p >= 80 ? 'var(--success)' : p >= 50 ? 'var(--warn)' : 'var(--danger)';
  document.getElementById('sum-warn').textContent = warnCount;
  document.getElementById('sum-pending').textContent = pendingCount;

  // â”€â”€ Alert â”€â”€
  const alerts = orgs.filter(o => o.status === 'warn').map(o =>
    `<strong>[ë³‘ëª© ê²½ê³ ]</strong> ${o.name} â€” ${o.plan}ë§¤ ëª©í‘œ ì¤‘ ${o.done}ë§¤ ì™„ë£Œ (ë¯¸ì™„ ${o.plan - o.done}ë§¤)`
  );
  const alertEl = document.getElementById('alert-box');
  if (alerts.length) {
    alertEl.innerHTML = alerts.join('<br>');
    alertEl.style.display = 'block';
  } else {
    alertEl.innerHTML = 'âœ… ì´ë²ˆ ë‹¬ ë³‘ëª© í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.';
    alertEl.style.display = 'block';
  }

  // â”€â”€ Cards â”€â”€
  document.getElementById('cards-grid').innerHTML = orgs.map(o => orgCard(o)).join('');
}

function buildOrgStats() {
  const m = CURRENT_MONTH;

  // SKKU
  const skku = filterMonth(DB.skku, m);
  const skkuDone = sum(skku, 'qty_completed'), skkuPlan = sum(skku, 'qty_planned');

  // íŒŒì¸ë©
  const fl = filterMonth(DB.finelab, m);
  const flDone = sum(fl, 'qty_completed'), flPlan = sum(fl, 'qty_planned');

  // NNFC backplane (2ë‹¬ ë‹¨ìœ„ - í˜„ì¬ ë‹¬ í¬í•¨ period)
  const bp = (DB.nnfc_backplane||[]).filter(r => periodIncludes(r.period, m));
  const bpDone = sum(bp, 'qty_completed'), bpPlan = sum(bp, 'qty_planned');

  // NNFC masking
  const mk = filterMonth(DB.nnfc_masking, m);
  const mkDone = sum(mk, 'qty_masked'), mkPlan = sum(mk, 'qty_received') || 5;

  // ê¸ˆì˜¤ê³µëŒ€
  const kit = filterMonth(DB.kit, m);
  const kitDone = sum(kit, 'qty_completed'), kitPlan = sum(kit, 'qty_planned');

  // KIMM transfer
  const ktr = filterMonth(DB.kimm_tr, m);
  const ktrDone = sum(ktr, 'qty_transferred'), ktrPlan = sum(ktr, 'qty_planned');
  const pending = ktr.filter(r => ['ëŒ€ê¸°','ì „ì‚¬ì¤‘'].includes(r.status)).length;

  function st(done, plan) {
    if (plan === 0) return 'none';
    return done >= plan ? 'ok' : done > 0 ? 'warn' : 'none';
  }

  return [
    { key:'kimm', cls:'kimm', role:'ì£¼ê´€ê¸°ê´€', name:'KIMM', plan:ktrPlan, done:ktrDone, pending, status:st(ktrDone,ktrPlan),
      bars:[{label:'QD ë°•ë§‰ ì „ì‚¬', done:ktrDone, plan:ktrPlan, fill:'fill-kimm'}, {label:'NNFC ë°œì†¡', done:sum(ktr,'qty_sent_to_nnfc'), plan:ktrPlan, fill:'fill-kimm'}] },
    { key:'skku', cls:'skku', role:'ì°¸ì—¬ê¸°ê´€', name:'SKKU ì„±ê· ê´€ëŒ€', plan:skkuPlan||5, done:skkuDone, pending:0, status:st(skkuDone,skkuPlan||5),
      bars:[{label:'QD ë°•ë§‰ ì œì‘', done:skkuDone, plan:skkuPlan||5, fill:'fill-skku'}] },
    { key:'finelab', cls:'finelab', role:'ê¸°ì—…ì°¸ì—¬ê¸°ê´€', name:'íŒŒì¸ë©', plan:flPlan||5, done:flDone, pending:0, status:st(flDone,flPlan||5),
      bars:[{label:'QD ë°•ë§‰ ì œì‘', done:flDone, plan:flPlan||5, fill:'fill-finelab'}] },
    { key:'nnfc', cls:'nnfc', role:'ì°¸ì—¬ê¸°ê´€', name:'NNFC', plan:bpPlan||5, done:bpDone+mkDone, pending:0, status:st(bpDone,bpPlan||5),
      bars:[{label:'8ì¸ì¹˜ ë°±í”Œë ˆì¸', done:bpDone, plan:bpPlan||5, fill:'fill-nnfc'},{label:'ë§ˆìŠ¤í¬ íŒ¨í„´', done:mkDone, plan:mkPlan, fill:'fill-nnfc'}] },
    { key:'kit', cls:'kit', role:'ì°¸ì—¬ê¸°ê´€', name:'ê¸ˆì˜¤ê³µëŒ€', plan:kitPlan||10, done:kitDone, pending:0, status:st(kitDone,kitPlan||10),
      bars:[{label:'SMP ì½”íŒ… PET', done:kitDone, plan:kitPlan||10, fill:'fill-kit'}] },
  ];
}

function filterMonth(rows, ym) {
  return (rows||[]).filter(r => (r.year_month||'') === ym);
}
function periodIncludes(period, ym) {
  if (!period) return false;
  const [start, end] = period.split('~').map(s => s.trim());
  return ym >= start && ym <= end;
}
function sum(rows, field) {
  return rows.reduce((acc, r) => acc + (parseInt(r[field])||0), 0);
}

function orgCard(o) {
  const barsHtml = o.bars.map(b => {
    const p = pct(b.done, b.plan);
    return `
      <div class="progress-row"><span class="progress-label">${b.label}</span><span class="progress-count">${b.done} / ${b.plan}</span></div>
      <div class="progress-bar-bg"><div class="progress-bar-fill ${b.fill}" style="width:${p}%"></div></div>`;
  }).join('');

  const badgeCls = o.status === 'ok' ? 'badge-ok' : o.status === 'warn' ? 'badge-warn' : 'badge-none';
  const badgeTxt = o.status === 'ok' ? 'ì™„ë£Œ' : o.status === 'warn' ? 'ì§„í–‰ì¤‘' : 'ëŒ€ê¸°';

  return `<div class="card ${o.cls}">
    <div class="card-header">
      <div><div class="card-title">${o.role}</div><div class="card-org ${o.cls}">${o.name}</div></div>
      <span class="badge ${badgeCls}">${badgeTxt}</span>
    </div>
    ${barsHtml}
    <div class="stat-row">
      <div class="stat-item"><div class="stat-value" style="color:${o.done>=o.plan?'var(--success)':'var(--warn)'}">${o.done}</div><div class="stat-label">ì™„ë£Œ</div></div>
      <div class="stat-item"><div class="stat-value" style="color:var(--muted)">${o.plan - o.done < 0 ? 0 : o.plan - o.done}</div><div class="stat-label">ë¯¸ì™„ë£Œ</div></div>
      <div class="stat-item"><div class="stat-value" style="color:var(--muted)">${o.plan}</div><div class="stat-label">ì›” ëª©í‘œ</div></div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TRACKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderTracker() {
  const sel = document.getElementById('month-select');
  const ym = sel?.value || CURRENT_MONTH;
  const tbody = document.getElementById('tracker-tbody');

  const rows = [];

  // SKKU
  filterMonth(DB.skku, ym).forEach(r => rows.push({
    id: r.batch_id, from:'SKKU', to:'KIMM', type: r.sample_type||'QD ë°•ë§‰',
    plan: r.qty_planned, done: r.qty_completed, date: r.sent_date, status: r.status, notes: r.notes
  }));
  // íŒŒì¸ë©
  filterMonth(DB.finelab, ym).forEach(r => rows.push({
    id: r.batch_id, from:'íŒŒì¸ë©', to:'KIMM', type: r.sample_type||'QD ë°•ë§‰',
    plan: r.qty_planned, done: r.qty_completed, date: r.sent_date, status: r.status, notes: r.notes
  }));
  // NNFC ë°±í”Œë ˆì¸ (period ê¸°ë°˜)
  (DB.nnfc_backplane||[]).filter(r => periodIncludes(r.period, ym)).forEach(r => rows.push({
    id: r.batch_id, from:'NNFC', to:'KIMM', type:`8ì¸ì¹˜ ë°±í”Œë ˆì¸ (${r.period})`,
    plan: r.qty_planned, done: r.qty_completed, date: r.sent_date, status: r.status, notes: r.notes
  }));
  // NNFC ë§ˆìŠ¤í¬
  filterMonth(DB.nnfc_masking, ym).forEach(r => rows.push({
    id: r.batch_id, from:'NNFC', to:'KIMM', type:'ë§ˆìŠ¤í¬ íŒ¨í„´ ë°˜í™˜',
    plan: r.qty_received, done: r.qty_masked, date: r.return_date, status: r.status, notes: r.notes
  }));
  // ê¸ˆì˜¤ê³µëŒ€
  filterMonth(DB.kit, ym).forEach(r => rows.push({
    id: r.batch_id, from:'ê¸ˆì˜¤ê³µëŒ€', to:'KIMM', type:`SMP PET (${r.smp_formulation||''})`,
    plan: r.qty_planned, done: r.qty_completed, date: r.sent_date, status: r.status, notes: r.notes
  }));
  // KIMM ì „ì‚¬
  filterMonth(DB.kimm_tr, ym).forEach(r => rows.push({
    id: r.batch_id, from:'KIMM', to:'NNFC', type:`QD ì „ì‚¬ (${r.qd_source||''})`,
    plan: r.qty_planned, done: r.qty_transferred, date: r.nnfc_sent_date||r.transfer_date, status: r.status, notes: r.notes
  }));

  if (!rows.length) {
    tbody.innerHTML = `<tr><td colspan="9" class="no-data">ì´ ë‹¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }

  tbody.innerHTML = rows.map(r => {
    const plan = parseInt(r.plan)||0, done = parseInt(r.done)||0;
    const p = pct(done, plan);
    const fromColor = ORG_COLOR[r.from]||'var(--text)', toColor = ORG_COLOR[r.to]||'var(--text)';
    return `<tr>
      <td class="td-mono" style="color:var(--accent)">${r.id||'â€”'}</td>
      <td style="color:${fromColor};font-weight:500">${r.from}</td>
      <td style="color:${toColor};font-weight:500">${r.to}</td>
      <td>${r.type}</td>
      <td class="td-mono" style="text-align:center">${plan}</td>
      <td><div class="qty-display"><span class="qty-done">${done}</span><span class="qty-slash">/</span><span class="qty-total">${plan}</span><span style="font-size:10px;color:var(--muted)">(${p}%)</span></div></td>
      <td class="td-mono" style="font-size:11px;color:var(--muted)">${r.date||'â€”'}</td>
      <td>${statusBadge(r.status)}</td>
      <td style="font-size:12px;color:var(--muted)">${r.notes||'â€”'}</td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCHEDULE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SCHEDULE_DATA = [
  { label:'1ë¶„ê¸°', title:'ë‹¨ìƒ‰ QD-EL í•µì‹¬ ê¸°ìˆ  ì™„ì„± ë° ì»¬ëŸ¬ íŒ¨ë„ ì œì‘ ì°©ìˆ˜', color:'var(--accent)',
    months:[
      { name:'1ì›”', tasks:[
        { id:'s01', text:'ë‹¨ìƒ‰ QD-EL ì „ì‚¬ ê³µì • ìµœì í™”', orgs:['KIMM','ê¸ˆì˜¤ê³µëŒ€'], done:true },
        { id:'s02', text:'QD ë°•ë§‰ ì „ì‚¬ ê¸°ìˆ ì´ì „', orgs:['KIMM','íŒŒì¸ë©'], done:true },
      ]},
      { name:'2ì›”', tasks:[
        { id:'s03', text:'ìƒ‰ìƒë³„ 2ì¸ì¹˜ QD-EL ì†Œì íš¨ìœ¨ í‰ê°€ ë° ê°œì„ ', orgs:['SKKU'], done:false },
        { id:'s04', text:'5000 PPI ë°±í”Œë ˆì¸ ì œì¡° ê³µì • í™•ë¦½', orgs:['NNFC'], done:false },
      ]},
      { name:'3ì›”', tasks:[
        { id:'s05', text:'RGB ì»¬ëŸ¬ ì ì¸µ ì „ì‚¬ 1ì°¨ ì‹œí—˜', orgs:['KIMM'], done:false },
        { id:'s06', text:'RGB ì»¬ëŸ¬ íŒ¨ë„ ì œì‘ ì°©ìˆ˜', orgs:[], done:false, milestone:true },
      ]},
    ]},
  { label:'2ë¶„ê¸°', title:'RGB ì»¬ëŸ¬ QD-EL ì ì¸µ ì „ì‚¬ ê°œë°œ ë° IMID ì „ì‹œìš© ìƒ˜í”Œ ì œì‘', color:'var(--accent2)',
    months:[
      { name:'4ì›”', tasks:[
        { id:'s07', text:'RGB ì ì¸µ ì „ì‚¬ ê³µì • ë¬¸ì œì  ë¶„ì„ ë° ê°œì„ ', orgs:['KIMM','ê¸ˆì˜¤ê³µëŒ€'], done:false },
        { id:'s08', text:'ì „í•˜ì „ë‹¬ì¸µ-QD ë‹¤ì¸µ ë°•ë§‰ ê³„ë©´ ì•ˆì •í™” ê²€ì¦', orgs:['SKKU'], done:false },
      ]},
      { name:'5ì›”', tasks:[
        { id:'s09', text:'8ì¸ì¹˜ ìŠ¤ì¼€ì¼ RGB ì»¬ëŸ¬ ì ì¸µ ì „ì‚¬ ì‹œí—˜', orgs:['KIMM'], done:false },
        { id:'s10', text:'8ì¸ì¹˜ ì»¬ëŸ¬ ì ë“± ë°±í”Œë ˆì¸ 1ì°¨ ì œì‘', orgs:['NNFC'], done:false },
      ]},
      { name:'6ì›”', tasks:[
        { id:'s11', text:'IMID 2026 ì „ì‹œìš© 8ì¸ì¹˜ 5000 PPI ì»¬ëŸ¬ íŒ¨ë„ ì œì‘ ì™„ë£Œ', orgs:[], done:false, milestone:true },
        { id:'s12', text:'ì „ì‹œìš© íŒ¨ë„ ì ë“± í…ŒìŠ¤íŠ¸ ë° í’ˆì§ˆ ê²€ì¦', orgs:[], done:false },
      ]},
    ]},
  { label:'3ë¶„ê¸°', title:'IMID 2026 ì „ì‹œíšŒ ë° 8ì¸ì¹˜ ì»¬ëŸ¬ íŒ¨ë„ í’ˆì§ˆ ê°œì„ ', color:'var(--accent4)',
    months:[
      { name:'7ì›”', tasks:[
        { id:'s13', text:'IMID 2026 ì „ì‹œíšŒ ì°¸ê°€ â€” 5000 PPIê¸‰ 8ì¸ì¹˜ ì»¬ëŸ¬ QD-EL íŒ¨ë„ ì „ì‹œ', orgs:[], done:false, milestone:true },
        { id:'s14', text:'ì „ì‹œíšŒ í”¼ë“œë°± ìˆ˜ë ´ ë° ê°œì„  ë°©í–¥ ë„ì¶œ', orgs:[], done:false },
      ]},
      { name:'8ì›”', tasks:[
        { id:'s15', text:'8ì¸ì¹˜ ì»¬ëŸ¬ íŒ¨ë„ ìˆ˜ìœ¨ ê°œì„ ', orgs:['ê¸ˆì˜¤ê³µëŒ€'], done:false },
        { id:'s16', text:'QD-EL ì†Œì íš¨ìœ¨ ìµœì í™”', orgs:['SKKU'], done:false },
      ]},
      { name:'9ì›”', tasks:[
        { id:'s17', text:'í”„ë¡ íŠ¸í”Œë ˆì¸ ì œì¡° ê³µì • ì‹¤ìš©í™” ì™„ë£Œ', orgs:['íŒŒì¸ë©'], done:false },
        { id:'s18', text:'ê³µì¸ì¸ì¦ìš© ìµœì¢… ìƒ˜í”Œ ì œì‘ ì°©ìˆ˜', orgs:[], done:false, milestone:true },
      ]},
    ]},
  { label:'4ë¶„ê¸°', title:'ê¸°ìˆ ì  ëª©í‘œ ë‹¬ì„± ê³µì¸ì¸ì¦ ë° ê³¼ì œ ë§ˆë¬´ë¦¬', color:'var(--accent3)',
    months:[
      { name:'10ì›”', tasks:[
        { id:'s19', text:'5000 PPI ë‹¬ì„± ì „ìí˜„ë¯¸ê²½ ê²€ì‚¬ ì¸ì¦', orgs:['NNFC'], done:false },
        { id:'s20', text:'QD-EL ì†Œì EQE ëª©í‘œ ë‹¬ì„± ì¸ì¦', orgs:['SKKU'], done:false },
      ]},
      { name:'11ì›”', tasks:[
        { id:'s21', text:'8ì¸ì¹˜ ì›¨ì´í¼ êµ¬í˜„ ì¸ì¦', orgs:['KIMM'], done:false },
        { id:'s22', text:'ì „ì‚¬ ìˆ˜ìœ¨ ëª©í‘œ ë‹¬ì„± ì¸ì¦', orgs:['KIMM','ê¸ˆì˜¤ê³µëŒ€'], done:false },
        { id:'s23', text:'ì „ì‚¬ ê¸°ë°˜ ì–‘ìì  ë””ìŠ¤í”Œë ˆì´ ì œì¡° ê¸°ìˆ  ì´ì „', orgs:['íŒŒì¸ë©'], done:false },
      ]},
      { name:'12ì›”', tasks:[
        { id:'s24', text:'ì „ì²´ ê³µì¸ì¸ì¦ ì™„ë£Œ ë° ìµœì¢… ì„±ê³¼ ë³´ê³ ì„œ ì‘ì„±', orgs:[], done:false, milestone:true },
        { id:'s25', text:'ê³¼ì œ ë§ˆë¬´ë¦¬ ë° ì •ì‚°', orgs:[], done:false },
      ]},
    ]},
];

const ORG_TAG_CLS = { KIMM:'tag-kimm', SKKU:'tag-skku', NNFC:'tag-nnfc', 'ê¸ˆì˜¤ê³µëŒ€':'tag-kit', 'íŒŒì¸ë©':'tag-fl' };

// ì²´í¬ ìƒíƒœ ì €ì¥ (sessionStorage)
function loadSchState() {
  try { return JSON.parse(sessionStorage.getItem('nc_sch')||'{}'); } catch { return {}; }
}
function saveSchState() {
  const obj = {};
  SCHEDULE_DATA.forEach(q => q.months.forEach(m => m.tasks.forEach(t => { obj[t.id] = t.done; })));
  try { sessionStorage.setItem('nc_sch', JSON.stringify(obj)); } catch {}
}
function applySchState() {
  const s = loadSchState();
  SCHEDULE_DATA.forEach(q => q.months.forEach(m => m.tasks.forEach(t => {
    if (s[t.id] !== undefined) t.done = s[t.id];
  })));
}

function allSchTasks() { return SCHEDULE_DATA.flatMap(q => q.months.flatMap(m => m.tasks)); }
function schPct(tasks) { return tasks.length ? Math.round(tasks.filter(t=>t.done).length/tasks.length*100) : 0; }

function updateSchGlobal() {
  const p = schPct(allSchTasks());
  document.getElementById('sch-total-pct').textContent = p + '%';
  document.getElementById('sch-global-bar').style.width = p + '%';
  SCHEDULE_DATA.forEach((q, qi) => {
    const tasks = q.months.flatMap(m => m.tasks);
    const qp = schPct(tasks);
    const pctEl = document.getElementById(`qpct-${qi}`);
    const barEl = document.getElementById(`qbar-${qi}`);
    if (pctEl) { pctEl.textContent = qp+'%'; pctEl.style.color = qp===100?'var(--success)':qp>0?'var(--accent)':'var(--muted)'; }
    if (barEl) barEl.style.width = qp+'%';
  });
}

function toggleTask(id) {
  SCHEDULE_DATA.forEach(q => q.months.forEach(m => m.tasks.forEach(t => { if (t.id===id) t.done=!t.done; })));
  saveSchState();
  const el = document.querySelector(`[data-task="${id}"]`);
  if (el) el.classList.toggle('done');
  updateSchGlobal();
}

function renderSchedule() {
  applySchState();
  const root = document.getElementById('schedule-root');
  root.innerHTML = SCHEDULE_DATA.map((q, qi) => {
    const tasks = q.months.flatMap(m => m.tasks);
    const p = schPct(tasks);
    const monthsHtml = q.months.map(m => {
      const tasksHtml = m.tasks.map(t => {
        const tags = t.orgs.map(o => `<span class="task-tag ${ORG_TAG_CLS[o]||''}">${o}</span>`).join('');
        return `<div class="task-item${t.done?' done':''}${t.milestone?' milestone':''}" data-task="${t.id}" onclick="toggleTask('${t.id}')">
          ${t.milestone ? `<span class="milestone-star">â˜…</span>` : `<div class="task-checkbox"></div>`}
          <div class="task-right">
            <div class="task-text">${t.text}</div>
            ${t.orgs.length ? `<div class="task-tags">${tags}</div>` : ''}
          </div>
        </div>`;
      }).join('');
      return `<div class="month-group">
        <div class="month-label-row"><span class="month-badge">${m.name}</span><div class="month-rule"></div></div>
        ${tasksHtml}
      </div>`;
    }).join('');
    return `<div class="quarter-block">
      <div class="quarter-header">
        <div><div class="quarter-label">${q.label} Â· 2026</div><div class="quarter-title">${q.title}</div></div>
        <div style="text-align:right"><div class="qpct" id="qpct-${qi}" style="color:${p===100?'var(--success)':p>0?'var(--accent)':'var(--muted)'}">${p}%</div><div class="qpct-label">ë‹¬ì„±</div></div>
      </div>
      <div class="quarter-bar-bg"><div class="quarter-bar-fill" id="qbar-${qi}" style="width:${p}%;background:${q.color}"></div></div>
      <div class="months-list">${monthsHtml}</div>
    </div>`;
  }).join('');
  updateSchGlobal();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.tab').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderSchedule();
loadData();
</script>
</body>
</html>
